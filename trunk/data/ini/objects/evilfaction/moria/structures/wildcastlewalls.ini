; ####################################################
; "Battle for Middle Earth II - Special Extended Edition - Director's Cut"
; ####################################################

; WildCastleWalls.INI for MORIA (Wild) faction...
; ------------------------------------------------------------------------------ 
; NOTE: Keep this organized!



;------------------------------------------------------------------------------
;Creating this WallHub will randomize between potentially several variations of the WallHub
;important only to the AI.
;------------------------------------------------------------------------------
Object WildCastleWallHubAI

  SelectPortrait = BRAWildWallHub

	Draw = W3DHordeModelDraw ModuleTag_01  ;W3DScriptedModelDraw
		DefaultModelConditionState
			Model = WBWallHub //pspikebarricade
		End
	End

	;***** IMPORTANT NOTE! *******************************************************************	
	;Certain Upgrades and costs may need to be propagated from here. One example was veterancy overlays.
	;*****************************************************************************************	
	
	; ***DESIGN parameters ***
	DisplayName = OBJECT:WildWallHub
	Side = Wild
	EditorSorting = STRUCTURE
  
	BuildVariations = WildCastleWallHubAIVariation1

	; *** ENGINEERING Parameters ***
	RadarPriority = STRUCTURE
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB MADE_OF_STONE WALL_UPGRADE
	CommandSet = WildCastleWallHubCommandSetAI_SEE

End

;---------------------------------------------
Object WildCastleWallHub
  
  ; *** ART Parameters ***
  
  SelectPortrait = BRAWildWallHub //BPIWall_WallHub
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = WBWallHub //pspikebarricade
		End
		
		IdleAnimationState
			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
			; Animation =	ReallyDamagedanimation
				; //AnimationName =	 IBWallRmprt.IBWallRmprt
				; AnimationName =	 GBWallRmprtN.GBWallRmprtN
				; AnimationMode =	LOOP
			; End
			StateName = STATE_None
		End
    
		;------------ New Build Up States coming soon. 
		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = WBWallHub_A //pspikebarricade
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
    
		ModelConditionState = AWAITING_CONSTRUCTION 
			Model = WBWallHub_A //pspikebarricade
		End
		AnimationState = AWAITING_CONSTRUCTION
			Animation = WBWallHub_A //dolgulwall_abld
				AnimationName = WBWallHub_A.WBWallHub_A //pspikebarricade.pspikebarricade
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
			Flags = START_FRAME_FIRST
		End

		;ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED //NOT USED!!!
		;	Model	= dolgulhub //IBWallRmprtN_A
		;	Texture	= IBFortress.tga IBFortress_U.tga
		;End

		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = WBWallHub_A //pspikebarricade
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
		
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = WBWallHub_A //pspikebarricade
		End
	    
		AnimationState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation = WBWallHub_A
				AnimationName = WBWallHub_A.WBWallHub_A
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
			Flags = START_FRAME_FIRST
			StateName = BeingConstructed
			ParticleSysBone = NONE WallConstructDust FollowBone:Yes
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End
		

		;--damaged building
	  
		ModelConditionState = DAMAGED
			Model = WBWallHub_D1 //pspikebarricade //dolgulhub_d1 //IBWallRmprtN_D1  
			;Texture	= dolgolgate.tga dolgolgate_d1.tga //ADDED FOR SEE!!!
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_HubDamaged
		End	    
		
		ModelConditionState = REALLYDAMAGED
			Model = WBWallHub_D2 //pspikebarricade //dolgulhub_d2 //IBWallRmprtN_D2
			;Texture	= dolgolgate.tga dolgolgate_d2.tga //ADDED FOR SEE!!!
		End
	    AnimationState = REALLYDAMAGED
        Animation =	RubbleAnimation
  				AnimationName = WBWallHub_D2.WBWallHub_D2 //pspikebarricade.pspikebarricade //dolgulhub_d2.dolgulhub_d2 //IBWallRmprtN_D2.IBWallRmprtN_D2
  				AnimationMode = ONCE
  			End
		    EnteringStateFX	= FX_HubDamaged
		End
      
		ModelConditionState = COLLAPSING
			Model = WBWallHub_D3 //pspikebarricade //dolgulhub_d3 //IBWallRmprtN_D3
			;Texture	= dolgolgate.tga dolgolgate_d3.tga //ADDED FOR SEE!!!
		End
		AnimationState = COLLAPSING
			Animation =	RubbleAnimation
				AnimationName = WBWallHub_D3.WBWallHub_D3 //pspikebarricade.pspikebarricade //dolgulhub_d3.dolgulhub_d3 //IBWallRmprtN_D3.IBWallRmprtN_D3
				AnimationMode = ONCE
			End
			;ParticleSysBone NONE HubDestructionDust		; A little too much dust for SEE!
			EnteringStateFX	= FX_StructureMediumCollapse
		End
    
		; ModelConditionState = DYING
			; Model = pspikebarricade //dolgulhub_d3 //IBWallRmprtN_D3
			// Texture	= dolgolgate.tga dolgolgate_d3.tga //ADDED FOR SEE!!!
		; End
		; AnimationState = DYING
      ; Animation =	RubbleAnimation
				; AnimationName = pspikebarricade.pspikebarricade //dolgulhub_d3.dolgulhub_d3 //IBWallRmprtN_D3.IBWallRmprtN_D3
				; AnimationMode = ONCE
      ; End
      ; ParticleSysBone NONE HubDestructionDust
      ; EnteringStateFX	= FX_StructureMediumCollapse
		; End
    
		ModelConditionState = RUBBLE
			Model = None  
		End  
		AnimationState = RUBBLE
		End 
		
		ModelConditionState = POST_RUBBLE
			Model = NONE
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState = POST_COLLAPSE
		Model = None
		End
		AnimationState = POST_COLLAPSE
		End 

		;ModelConditionState = UPGRADE_NUMENOR_STONEWORK //NOT USED!!!
		;	Model	= dolgulhub //IBWallRmprtN
		;	Texture	= IBFortress.tga IBFortress_U.tga
		;End
    
		ModelConditionState = SNOW  
			Model = WBWallHub //pspikebarricade
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
    
	End
	
	Draw = W3DFloorDraw ModuleTag_DrawFloor    
    StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
    ModelName = DBWallRmprtNBib
    WeatherTexture = SNOWY GBWall_Bib_Snow.tga 
    HideIfModelConditions = AWAITING_CONSTRUCTION
    HideIfModelConditions = PARTIALLY_CONSTRUCTED
    ; HideIfModelConditions = COLLAPSING
    ; HideIfModelConditions = RUBBLE
	End
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState = COLLAPSING
			Model = GBWall_Rubble
		End
		AnimationState = COLLAPSING
		End
		
		ModelConditionState = RUBBLE
			Model = GBWall_Rubble
		End
	    
		ModelConditionState = POST_RUBBLE
			Model = None ;GBWall_Rubble
		End
    
		ModelConditionState = POST_COLLAPSE
			Model = None
		End
	End
  
	; ***DESIGN parameters ***
	RadarPriority = STRUCTURE	
	DisplayName = OBJECT:WildWallHub
	Side = Wild
	EditorSorting = STRUCTURE
	ThreatLevel = 1.0
	
	Scale = 2.0 
	
	BuildCost 			= WILD_CASTLE_WALLHUB_BUILDCOST
	BuildTime 			= WILD_CASTLE_WALLHUB_BUILDTIME
	VisionRange 		= WILD_CASTLE_WALLHUB_VISION_RANGE
	ShroudClearingRange 	= WILD_CASTLE_WALLHUB_SHROUD_CLEAR

	; EquivalentTo = WildCastleWallHubAI

	CommandSet = WildCastleWallHubCommandSet //IsengardCastleWallHubCommandSet
	

	; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

  VoiceSelect = NeutralWallHubSelect	;Gui_PlotSelect2
  VoiceSelectUnderConstruction = BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged = BuildingLightDamageStone
	SoundOnReallyDamaged = BuildingHeavyDamageStone

  UnitSpecificSounds
    UnderConstruction = BuildingConstructionLoop  		; Built first time
    ; UnderRepairFromDamage = NoSound				; Repaired No animation on the building, so don't bother playing sound
    UnderRepairFromRubble = BuildingConstructionLoop		; Repaired from completely destroyed (not used???)
  End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:COLLAPSING	 Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority = STRUCTURE
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB WALL_UPGRADE MADE_OF_STONE	FS_BASE_DEFENSE IGNORE_FOR_VICTORY
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
  
	Behavior = CastleMemberBehavior ModuleTag_CMB
  End 
  
	Behavior = ProductionUpdate ProductionUpdateModuleTag
	End
  
	Behavior = GrantUpgradeCreate ModuleTag_ActLikeAnOldUpgrade
		UpgradeToGrant = Upgrade_HubIsBuilt
		GiveOnBuildComplete = Yes
	End
  
	Behavior = GettingBuiltBehavior ModuleTag_04
		; UseSpawnTimerWithoutWorker = Yes
		SpawnTimer = -1.0 ;M_DEFAULT_STRUCTURE_HEALDELAY
		;SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop = WallConstructionLoop
		SelfRepairFromRubbleLoop = BuildingConstructionLoop
		RebuildTimeSeconds 		= WILD_CASTLE_WALLHUB_BUILDTIME
	End

	Body = StructureBody ModuleTag_05
		MaxHealth 				= WILD_CASTLE_WALLHUB_HEALTH
		MaxHealthDamaged 		= WILD_CASTLE_WALLHUB_HEALTH_DAMAGED
		MaxHealthReallyDamaged 	= WILD_CASTLE_WALLHUB_HEALTH_REALLY_DAMAGED
	End
  
  ;This is important to let the user select the rubble to begin self repair
  KeepSelectableWhenDead	= Yes
  
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes = ALL -SUICIDED
	End
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes = NONE +SUICIDED
		DestructionDelay = 5000
	End
	// These should always appear together on wall segments
  
	Behavior = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate 
		MinCollapseDelay = 000
		MaxCollapseDelay = 000
		CollapseDamping = .5
		MaxShudder = 0.6
		MinBurstDelay = 250
		MaxBurstDelay = 800
		BigBurstFrequency = 4
		FXList = INITIAL FX_StructureMediumCollapseNoSound
		FXList = ALMOST_FINAL FX_StructureAlmostCollapse
		DestroyObjectWhenDone = Yes
		CollapseHeight = 0
	End
  
	Behavior = WallHubBehavior ModuleTag_WALL_HUB

		Options = OPTION_ONE
		MaxBuildoutDistance = WILD_FORTRESS_WALL_EFFECTIVE_RADIUS ;M_MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR
		
		;;This defines the pattern built on flat terrain
		SegmentTemplateName = WildCastleWallSegment //IsengardCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment	
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallHub
		
		BuilderRadius = 20
		
		HubCapTemplateName = WildCastleWallHub //MordorCastleWallHub //IsengardCastleWallHub
		DefaultSegmentTemplateName = WildCastleWallSegment //MordorCastleWallSegment //IsengardCastleWallSegment

		CliffCapTemplateName = WildWallCliffCap //MordorWallCliffCap //IsengardWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]

	End
	
	
	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius = 60		;// How far we try to claim ground
		MaxIncome = 0			;// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval = 999999	;// How often (in msec) we give that much money
		HighPriority = Yes		;// A high priority claim gets to pretend it was there first.
		Visible = No 		;// Don't show decal when a resource building is selected.
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = WILD_FORTRESS_WALL_EFFECTIVE_RADIUS ;M_ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_IsengardFortressIronPlating
		ObjectFilter = ANY +IsengardFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy = Upgrade_IsengardFortressIronPlating
		AttributeModifier = IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy = Upgrade_IsengardFortressIronPlating		
		AddConditionFlags = UPGRADE_NUMENOR_STONEWORK
		Permanent = Yes
	End	
	
	ArmorSet
		Conditions = None
		Armor = WildWallArmor
		DamageFX = None
	End

	;//	Geometry for the temp small men wall hub
	Geometry = CYLINDER
	GeometryMajorRadius = 20.0 ; 
	GeometryMinorRadius = 20.0 ; 
	GeometryHeight = 70.0
	GeometryIsSmall = No

	AdditionalGeometry = BOX
	GeometryMajorRadius = 5.0		;10.0 
	GeometryMinorRadius = 20.0
	GeometryHeight = 40.0	;47
	GeometryIsSmall = No
	
	Shadow = SHADOW_VOLUME
	BuildCompletion = PLACED_BY_PLAYER
	
	GeometryContactPoint = X:-21 Y:22 Z:0 Repair
	GeometryContactPoint = X:23 Y:-20 Z:0 Repair
	GeometryContactPoint = X:5.576 Y:44.987 Z:0
	GeometryContactPoint = X:-38.348 Y:-42.113 Z:0
	GeometryContactPoint = X:-28.448 Y:-0.003 Z:75.14 Swoop
End

;---------------------------------------------
ChildObject WildCastleWallHubAIRebuildable WildCastleWallHub

  KeepSelectableWhenDead	= No
  
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes = NONE +EXPLODED
	End
  
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes = ALL -EXPLODED
		DestructionDelay = 5000
	End
  
	Behavior = GettingBuiltBehavior ModuleTag_04
		; RebuildWhenDead = Yes
		UseSpawnTimerWithoutWorker = Yes
		SpawnTimer = DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds = WILD_CASTLE_WALLHUB_BUILDTIME
		SelfBuildingLoop = WallConstructionLoop			;Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop = WallConstructionLoop
		SelfRepairFromRubbleLoop = WallConstructionLoop
		; DisallowRebuildRange = 20 ;300
		; DisallowRebuildFilter = ANY +STRUCTURE
	End
  
	Behavior = RebuildHoleExposeDie ModuleTag_ExposeDie
		ExemptStatus = SOLD
		HoleName = WallHubHoleAI
		HoleMaxHealth = CREEP_LAIR_HEALTH_HOLE
		FadeInTimeSeconds = 2.0
		TransferAttackers = No
	End
  
End

;---------------------------------------------
ChildObject WildCastleWallHubAIVariation1 WildCastleWallHubAIRebuildable
  
	EquivalentTo = WildCastleWallHubAI

  CommandSet = WildCastleWallHubCommandSetAI_SEE
  
	Behavior = WallHubBehavior ModuleTag_WALL_HUB
		Options = OPTION_ONE
		MaxBuildoutDistance = WILD_FORTRESS_WALL_EFFECTIVE_RADIUS ;M_MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR
		
		;;This defines the pattern built on flat terrain
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegmentHoleAI
		SegmentTemplateName = WildCastleWallSegmentHoleAI
		SegmentTemplateName = WildCastleWallSegmentHoleAI
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallSegmentHoleAI
		SegmentTemplateName = WildCastleWallSegmentHoleAI
		SegmentTemplateName = WildCastleWallSegmentHoleAI
		SegmentTemplateName = WildCastleWallSegment
		SegmentTemplateName = WildCastleWallHubAIVariation1
		
		BuilderRadius = 20
		
		HubCapTemplateName = WildCastleWallHubAIVariation1 //MordorCastleWallHub //IsengardCastleWallHub
		DefaultSegmentTemplateName = WildCastleWallSegment //MordorCastleWallSegment //IsengardCastleWallSegment
    
		CliffCapTemplateName = WildWallCliffCap //MordorWallCliffCap //IsengardWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]
    
	End
  
End


Object WildCastleWallSegment
  ;PlacementViewAngle  = -45	   //Doesnt work!!!! :(  
	// *** ART Parameters ***  
  SelectPortrait = BRAWildWallSegment //BPIWall
    
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = pbarricade //mbwall_skn //dolgulwall_n //dolgulwall //IBWallN
		End
		
		IdleAnimationState
			; Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
			; Animation =	ReallyDamagedanimation
				; //AnimationName = IBWallRamp2.IBWallRamp2
				; AnimationName =  GBWallN.GBWallN
				; AnimationMode =	LOOP
 			; End
      StateName = STATE_None
		End
    
		//------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = WBWallN //pbarricade //mbwall_skn //dolgulwall_a //IBWallN_A //needs a new model placement
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
				
		ModelConditionState = AWAITING_CONSTRUCTION 
			Model = WBWallN_A
		End
		AnimationState = AWAITING_CONSTRUCTION
			Animation = WBWallN_A 
				AnimationName = WBWallN_A.WBWallN_A
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
			Flags = START_FRAME_FIRST
		End
    
		;ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED //WONT BE USED! No armor upgrade for Mordor!
		;	Model	= mbwall_skn //IBWallN_A
		;	Texture	= IBFortress.tga IBFortress_U.tga
		;End
		
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = WBWallN_A
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
		
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = WBWallN_A
		End
	    
		AnimationState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation = WBWallN_A
				AnimationName = WBWallN_A.WBWallN_A
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
			Flags = START_FRAME_FIRST
			StateName = BeingConstructed
			ParticleSysBone = NONE WallConstructDust FollowBone:Yes
		End
		

		//--damaged building	  
		ModelConditionState = DAMAGED
			Model = WBWallN_D1  
			;Texture	= dolgolgate.tga dolgolgate_d1.tga //ADDED FOR SEE!!!
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState = REALLYDAMAGED
			Model = WBWallN_D2
			;Texture	= dolgolgate.tga dolgolgate_d2.tga //ADDED FOR SEE!!!
		End
		AnimationState = REALLYDAMAGED
			Animation =	RubbleAnimation
				AnimationName = WBWallN_D2.WBWallN_D2
				AnimationMode = ONCE
			End
			EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState = COLLAPSING
			Model = WBWallN_D3
			;Texture	= dolgolgate.tga dolgolgate_d3.tga //ADDED FOR SEE!!!
		End
		AnimationState = COLLAPSING
			Animation =	RubbleAnimation
				AnimationName = WBWallN_D3.WBWallN_D3
				AnimationMode = ONCE
			End
			ParticleSysBone NONE WallDestructionDust
		End
    
		ModelConditionState = RUBBLE
			Model = None	;GBWall_Rubble  
		End  
		
		ModelConditionState = POST_RUBBLE
			Model = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End
    
		ModelConditionState = POST_COLLAPSE
			Model = None
		End
		AnimationState = POST_COLLAPSE
		End
    
		ModelConditionState = SNOW  
			Model = WBWallN
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
    
	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState = COLLAPSING
			Model = GBWall_Rubble
		End
		
		; ModelConditionState = RUBBLE
			; Model = GBWall_Rubble
		; End
	    
		; ModelConditionState = POST_RUBBLE
			; Model = GBWall_Rubble
		; End
    
		ModelConditionState = POST_COLLAPSE
			Model = None
		End
	End
  
  Draw = W3DFloorDraw ModuleTag_DrawFloor    
    StaticModelLODMode =	yes ; Will append M or L to the skin name depending on GameLOD
    ModelName =	GBWallN_Bib
    WeatherTexture =	SNOWY GBWall_Bib_Snow.tga
    HideIfModelConditions = AWAITING_CONSTRUCTION
    HideIfModelConditions = PARTIALLY_CONSTRUCTED
    ; HideIfModelConditions = COLLAPSING
    ; HideIfModelConditions = RUBBLE
  End
  
	// ***DESIGN parameters ***
	DisplayName = OBJECT:WildWallSegment ;OBJECT:IsengardCastleWallSegment
	Side = Wild //Mordor
	EditorSorting = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost = WILD_WALLSEGMENT_SMALL_BUILDCOST ;M_ISENGARD_CASTLE_WALLSEGMENT_BUILDCOST
	BuildTime = WILD_WALLSEGMENT_SMALL_BUILDTIME ;M_ISENGARD_CASTLE_WALLSEGMENT_BUILDTIME
	VisionRange = WILD_WALLSEGMENT_SMALL_VISION_RANGE
	ShroudClearingRange = WILD_WALLSEGMENT_SMALL_SHROUD_CLEAR
	CommandSet = WildWallUpgradeNodeCommandSet //IsengardWallUpgradeNodeCommandSet

	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect = Gui_PlotSelect2
  VoiceSelectUnderConstruction = BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged = BuildingLightDamageStone
	SoundOnReallyDamaged = BuildingHeavyDamageStone

  UnitSpecificSounds
    UnderConstruction		= WallConstructionLoop  ; Built first time
    ; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
    UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
  End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority = STRUCTURE
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE IGNORE_FOR_VICTORY WALL_SEGMENT MADE_OF_STONE DEFENSIVE_WALL FS_BASE_DEFENSE HAS_HEALTH_BAR ;SCALEABLE_WALL (Sharp spikes!)
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
  
  Behavior = AIUpdateInterface ModuleTag_AIForSequentialScriptsToWork
    AutoAcquireEnemiesWhenIdle	= No
  End
  
	Behavior = GettingBuiltBehavior ModuleTag_04
		; UseSpawnTimerWithoutWorker = Yes
		SpawnTimer = -1.0 ;M_DEFAULT_STRUCTURE_HEALDELAY
		SelfBuildingLoop = WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop = NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop = WallConstructionLoop
		RebuildTimeSeconds = WILD_WALLSEGMENT_SMALL_BUILDTIME
	End
  
	Behavior = CastleMemberBehavior ModuleTag_CMB
  End 
  
	Body = StructureBody ModuleTag_05
		MaxHealth = WILD_CASTLE_WALLSEGMENT_HEALTH //M_ISENGARD_CASTLE_WALLSEGMENT_HEALTH
		MaxHealthDamaged = WILD_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
		MaxHealthReallyDamaged = WILD_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
	End
  
  ;This is important to let the user select the rubble to begin self repair
  KeepSelectableWhenDead	= Yes
  
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes = ALL -SUICIDED -FADED
	End
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes = NONE +SUICIDED +FADED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments
  
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
		ReplaceWith =  IsengardCastleWallHub ;WildCastleWallHub
		TriggeredBy =  Upgrade_IsengardWallHub ;Upgrade_WildWallHub
		ConflictsWith = Upgrade_IsengardWallRegularGate ;Upgrade_MordorWallRegularGate
	End
  
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
		ReplaceWith = IsengardCastleWallGate
		TriggeredBy = Upgrade_IsengardWallRegularGate
		ConflictsWith = Upgrade_IsengardWallHub
	End
  
	Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
	End
  
	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = WILD_FORTRESS_WALL_EFFECTIVE_RADIUS ;M_ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_IsengardFortressIronPlating
		ObjectFilter = ANY +IsengardFortressCitadel
	End
  
	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy = Upgrade_IsengardFortressIronPlating
		AttributeModifier = IronPlatingExpansion_Bonus		
	End
  
	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy = Upgrade_IsengardFortressIronPlating		
		AddConditionFlags = UPGRADE_NUMENOR_STONEWORK
		Permanent = Yes
	End
  
	ArmorSet
		Conditions = None
		Armor = WildWallArmor
		DamageFX = None
	End
  
	;//	Geometry for the temp men small wall segment
	Geometry = BOX
	GeometryMajorRadius = 5.0 
	GeometryMinorRadius = 20.0
	GeometryHeight = 40.0	;47
	GeometryIsSmall = No
		;PlacementViewAngle  = -45	  //Doesnt work!!! :(
	;Geometry              = BOX
	;GeometryMajorRadius   = 25.0
	;GeometryMinorRadius   = 20.0
	;GeometryHeight        = 50
	;GeometryIsSmall       = No
  
	Shadow = SHADOW_VOLUME
	BuildCompletion = PLACED_BY_PLAYER
End


;----------------------------------------------------------------------
Object WildWallCliffCap

  ;PlacementViewAngle  = -45	   //Doesnt work!!!! :(  
	// *** ART Parameters ***  
  SelectPortrait = BRAWildWallSegment //BPIWall
    
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = WBWallN
		End
		
		IdleAnimationState
			; Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
			; Animation =	ReallyDamagedanimation
				; //AnimationName = IBWallRamp2.IBWallRamp2
				; AnimationName =  GBWallN.GBWallN
				; AnimationMode =	LOOP
 			; End
      StateName = STATE_None
		End
    
		//------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = WBWallN_A
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
				
		ModelConditionState = AWAITING_CONSTRUCTION 
			Model = WBWallN_A
		End
		AnimationState = AWAITING_CONSTRUCTION
			Animation = WBWallN_A
				AnimationName = WBWallN_A.WBWallN_A
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
			Flags = START_FRAME_FIRST
		End
    
		;ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED //WONT BE USED! No armor upgrade for Mordor!
		;	Model	= mbwall_skn //IBWallN_A
		;	Texture	= IBFortress.tga IBFortress_U.tga
		;End
		
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = WBWallN_A
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
		
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = WBWallN_A
		End
	    
		AnimationState = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation = WBWallN_A
				AnimationName = WBWallN_A.WBWallN_A
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
			Flags = START_FRAME_FIRST
			StateName = BeingConstructed
			ParticleSysBone = NONE WallConstructDust FollowBone:Yes
		End
		

		//--damaged building	  
		ModelConditionState = DAMAGED
			Model = WBWallN_D1 
			;Texture	= dolgolgate.tga dolgolgate_d1.tga //ADDED FOR SEE!!!
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState = REALLYDAMAGED
			Model = WBWallN_D2
			;Texture	= dolgolgate.tga dolgolgate_d2.tga //ADDED FOR SEE!!!
		End
    AnimationState = REALLYDAMAGED
      Animation =	RubbleAnimation
				AnimationName = WBWallN_D2.WBWallN_D2
				AnimationMode = ONCE
      End
      EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState = COLLAPSING
			Model = WBWallN_D3
			;Texture	= dolgolgate.tga dolgolgate_d3.tga //ADDED FOR SEE!!!
		End
		AnimationState = COLLAPSING
      Animation =	RubbleAnimation
				AnimationName = WBWallN_D3.WBWallN_D3
				AnimationMode = ONCE
      End
      ParticleSysBone NONE WallDestructionDust
		End
    
		ModelConditionState = RUBBLE
			Model = None	;GBWall_Rubble  
		End  
		
		ModelConditionState = POST_RUBBLE
			Model = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End
    
		ModelConditionState = POST_COLLAPSE
			Model = None
		End
		AnimationState = POST_COLLAPSE
		End
    
		ModelConditionState = SNOW  
			Model = WBWallN
			;Texture	= dolgolgate.tga dolgolgate_sn.tga //IBFortress.tga IBFortress_snow.tga
		End
    
	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState = COLLAPSING
			Model = GBWall_Rubble
		End
		
		; ModelConditionState = RUBBLE
			; Model = GBWall_Rubble
		; End
	    
		; ModelConditionState = POST_RUBBLE
			; Model = GBWall_Rubble
		; End
    
		ModelConditionState = POST_COLLAPSE
			Model = None
		End
	End
  
  Draw = W3DFloorDraw ModuleTag_DrawFloor    
    StaticModelLODMode =	yes ; Will append M or L to the skin name depending on GameLOD
    ModelName =	GBWallN_Bib
    WeatherTexture =	SNOWY GBWall_Bib_Snow.tga
    HideIfModelConditions = AWAITING_CONSTRUCTION
    HideIfModelConditions = PARTIALLY_CONSTRUCTED
    ; HideIfModelConditions = COLLAPSING
    ; HideIfModelConditions = RUBBLE
  End
  
  ; ***DESIGN parameters ***
  DisplayName = OBJECT:WildWallCliffCap ;OBJECT:IsengardWallCliffCap
  Side = Wild //Isengard
  EditorSorting = STRUCTURE
  ThreatLevel = 1.0
  
	CommandSet = IsengardWallCliffCapCommandSet
  
  BuildCost = WILD_WALLSEGMENT_SMALL_BUILDCOST
  BuildTime = WILD_WALLSEGMENT_SMALL_BUILDTIME
  VisionRange = WILD_WALLSEGMENT_SMALL_VISION_RANGE
  ShroudClearingRange = WILD_WALLSEGMENT_SMALL_SHROUD_CLEAR

  ; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
	SoundOnDamaged		= BuildingLightDamageStone
	SoundOnReallyDamaged	= BuildingHeavyDamageStone
  VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction
  
  UnitSpecificSounds
    UnderConstruction = WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage = NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble = WallConstructionLoop	; Repaired from completely destroyed (not used???)
  End

	;ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
	;	ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	;End

	CampnessValue = CAMPNESS_WALL

  ; *** ENGINEERING Parameters ***
  RadarPriority = STRUCTURE
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE IGNORE_FOR_VICTORY WALL_SEGMENT MADE_OF_STONE DEFENSIVE_WALL FS_BASE_DEFENSE HAS_HEALTH_BAR ;SCALEABLE_WALL (Sharp spikes!)
  ThreatBreakdown ThreatBreakdown_ModuleTag
    AIKindOf = WALL
  End
  
  Behavior = AIUpdateInterface ModuleTag_AIForSequentialScriptsToWork
    AutoAcquireEnemiesWhenIdle	= No
  End
  
	Behavior = GettingBuiltBehavior ModuleTag_04
		; UseSpawnTimerWithoutWorker = Yes
		SpawnTimer = -1.0 ;M_DEFAULT_STRUCTURE_HEALDELAY
		SelfBuildingLoop = WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop = NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop = WallConstructionLoop
		RebuildTimeSeconds = WILD_WALLSEGMENT_SMALL_BUILDTIME
	End
  
	Behavior = CastleMemberBehavior ModuleTag_CMB
  End 
  
	Body = StructureBody ModuleTag_05
		MaxHealth = WILD_CASTLE_WALLSEGMENT_HEALTH //M_ISENGARD_CASTLE_WALLSEGMENT_HEALTH
		MaxHealthDamaged = WILD_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
		MaxHealthReallyDamaged = WILD_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
	End
  
  ;This is important to let the user select the rubble to begin self repair
  KeepSelectableWhenDead	= Yes
  
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes = ALL -SUICIDED
	End
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes = NONE +SUICIDED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments
  
  ArmorSet
		Conditions = None
		Armor = WildWallArmor
		DamageFX = None
	End
  
	Geometry = BOX
	GeometryMajorRadius = 10.0 
	GeometryMinorRadius = 40.0   
	GeometryHeight = 80
	GeometryIsSmall = No
	GeometryOffset = X:0 Y:-20 Z:-40
  
  Shadow = SHADOW_VOLUME
  BuildCompletion = PLACED_BY_PLAYER
End
;---------------------------------------------


ChildObject WildCastleWallSegmentHoleAI WildCastleWallSegment

	CommandSet = WildWallUpgradeNodeCommandSetHoleAI
 
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hole
		ReplaceWith = WildCastleWallSegmentHoleTempAI
		TriggeredBy = Upgrade_ObjectUnderAIControl_SEE
	End
  
	Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
	End
  
End

ChildObject WildCastleWallSegmentHoleTempAI WildCastleWallSegment
  
  CommandSet = IsengardWallCliffCapCommandSet
  
	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime = 2000
		MaxLifetime = 2000
		DeathType = FADED
	End	
  
	BuildCost = 0
	BuildTime = 1   ; in seconds

End
