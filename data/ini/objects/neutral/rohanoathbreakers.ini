
;------------------------------------------------------------------------------
;Creating this oathbreaker will randomize between several variations of the oathbreaker.
;------------------------------------------------------------------------------
Object RohanOathbreaker

	SelectPortrait         = UPOathBreakers

	Draw = W3DScriptedModelDraw ModuleTag_01  
		DefaultModelConditionState
			;Give it a model so it'll show up in WB
			Model               = RUPsnt_1_SKN
			Skeleton            = RUPsnt_1_SKL
		End
	End

	;***** IMPORTANT NOTE! ***************************************************************	
	;Certain Upgrades and costs may need to be propagated from here. One example was veterancy
	;overlays. See Zero Hour GLAVehicleTechnical for reference.
	;*************************************************************************************	

	Side = Neutral
	IsTrainable = No
	EditorSorting = UNIT
	BuildVariations = RohanOathbreaker1 RohanOathbreaker2 RohanOathbreaker3	
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT DOZER
	
  ;Shadow = SHADOW_DECAL
  ;ShadowSizeX = 24;
  ;ShadowSizeY = 24;
  ;ShadowTexture = ShadowI;

End

;------------------------------------------------------------------------------
; aka Oathbreakers, Dead, Army of the Dead
Object RohanOathbreaker1
	; *** ART Parameters ***

	SelectPortrait         = UPOathBreakers

	Draw = W3DHordeModelDraw ModuleTag_01

		DefaultModelConditionState
			Model               = RUOath3A_SKN
			Skeleton            = RUOath3_SKL
            ParticleSysBone = NONE AODTrails FollowBone:no
 		End
   
		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLA
				AnimationName       = RUOath3_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 20
			End			
		End

		
		AnimationState        = DYING
			Animation           = RUNA
				AnimationName     = RUOath3A_DIEA
			End
            EnteringStateFX = FX_AODDeath
		End

		AnimationState        =  OATH_FULLFILLED
			Animation           = WLK
				AnimationName     = RUOath3_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End

		AnimationState        =  ATTACKING
			Animation           = ATA1
				AnimationName     = RUOath3_ATKA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.75 1.25
			End
		End

		AnimationState        =  FIRING_A
			Animation           = ATA1
				AnimationName     = RUOath3_ATKA
				AnimationMode     = LOOP
			End
		End

		AnimationState        = MOVING
			Animation           = RUNA
				AnimationName     = RUOath3_RUNA
				AnimationMode     = LOOP
			End
			Flags               = RANDOMSTART
		End
		
	End
	
	; ***DESIGN parameters ***
	Side = Neutral
	IsTrainable = No
	EditorSorting = UNIT
	ThreatLevel = 3.0
	ThingClass = HORDE_UNIT
	CommandPoints = 0

	EmotionRange = 0 ; Make sure this value is greater than the fear distribution range. 

	TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT
	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    OathbreakerSword
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	ArmorSet
		Conditions      = None
		Armor           = OathBreakerArmor
		DamageFX        = NormalDamageFX
	End
	VisionRange = 81
	DisplayName = OBJECT:Oathbreaker
	CrushableLevel = 5  ; Nothing can crush these guys. What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
;	CrusherLevel = 4  ; They don't crush anyone - they use a custom module to do damage. What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS
	
	CommandSet = GondorFighterCommandSet
	EquivalentTo = RohanOathbreaker

	; *** AUDIO Parameters ***;

	VoiceAttack			= OathbreakerVoxSelect
;	VoiceCreated		= OathbreakerVoxSelect
;	VoiceFullyCreated	= OathbreakerVoxSelect
	VoiceMove			= OathbreakerVoxSelect
	VoicePriority		= 15
	VoiceSelect			= OathbreakerVoxSelect

	SoundImpact			= ImpactHorse
	
	UnitSpecificSounds
		VoiceGarrison						= OathbreakerVoxSelect
		VoiceEnterUnitElvenTransportShip	= OathbreakerVoxSelect
		VoiceEnterUnitEvilMenTransportShip	= OathbreakerVoxSelect
		VoiceEnterUnitMordorMumakil			= OathbreakerVoxSelect
		VoiceEnterUnitSlaughterHouse		= OathbreakerVoxSelect
		VoiceInitiateCaptureBuilding		= OathbreakerVoxSelect
	End

    #include "..\includes\StandardUnitEvaEvents.inc"

    ; Warn the player when the enemy gets a unit. Override the normal sighting event from StandardUnitEvaEvents.inc
    EvaEnemyObjectSightedEvent	= DiscoveredEnemyOathbreaker		;GenericEnemyUnitSighted ; Normal response to enemy units

	ClientUpdate = EvaAnnounceClientCreate ModuleTag_CreateAnnounce
		AnnouncementEventEnemy = DiscoveredEnemyOathbreaker
		AnnouncementEventAlly = None
		AnnouncementEventOwner = None
		
		OnlyIfVisible = Yes						; Don't announce if hidden in the shroud
		CountAsFirstSightedAnnoucement = Yes	; Don't re-annouce if going into shroud & back
		UseObjectsPosition = No					; Play from central Fortress, not at unit's position
		CreateFakeRadarEvent = Yes				; Allow player to jump to unit after hearing annoucement
	End

	; *** ENGINEERING Parameters ***
	RadarPriority = UNIT
	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT ATTACK_NEEDS_LINE_OF_SIGHT ARMY_OF_DEAD
	
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 2000                
		MaxHealthDamaged  = 2000
		;RecoveryTime      = 15000
	End
	
	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle	=	Yes ATTACK_BUILDINGS
		MoodAttackCheckRate			=	500
	End

	LocomotorSet
		Locomotor = ArmyOfTheDeadLocomotor
		Condition = SET_NORMAL 
		Speed     = 100
		
	End

	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= OATHBREAKER_LIFETIME
		MaxLifetime		= OATHBREAKER_LIFETIME
	End	

	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
		ShockStunnedTimeLow		= 1400
		ShockStunnedTimeHigh	= 2400
		ShockStandingTime		= 2400
	End 
	
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath_01
		DeathTypes = ALL 
;		SinkDelay = 200
; Rising in animation, don't sink		SinkRate = 5.40     ; in Dist/Sec
		DestructionDelay = 3000
        FadeTime = 1000
        FadeDelay = 1000
		;Sound = INITIAL OathbreakerDie
	End
	
	
	Behavior = OathbreakersFadeAwayBehavior ModuleTag_05
		FadeOutTime   = 3500 ;  Fade time in ms - 4000 == 4 seconds.
	End

	Behavior = AODCrushCollide ModuleTag_06
		SmallFXList = FX_AODHitSmall; FXList for small objects.
		MediumFXList = FX_AODHitMedium; FXList for medium objects.
        ; LargeFXList = FX_AODHitLarge; FXList for medium objects.
		;MediumObjectCreationList = OCL_FireFieldSmall; disabled for now.
		
		; Normal damage delivered.
		Damage = 50 ;10.0
		DamageType = MAGIC
		DeathType = SUPERNATURAL
		
		SpecialObject = NONE +MordorBalrog +GondorAragorn -SELECTABLE -CAVALRY -INFANTRY -HERO -MONSTER; Special objects receive and dish out special damage.
		SpecialDamage = 5.0  ; not as lethal (has to be really small so as not to provoke a hit reaction from balrog, who wants to only react to phaser and lightning)
		SpecialDamageType = MAGIC
		SpecialDeathType = CRUSHED
		
		SelfDamage = 9999.0  ; Damaging a special object inflicts damage on self.
		SelfDamageType = FLAME
		SelfDeathType = BURNED
	End
	
	; Tie into LargeGroupAudio system
	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
		Key = Oathbreaker
	End

	Geometry = CYLINDER
	GeometryMajorRadius = 12.0
	GeometryMinorRadius = 12.0
	GeometryHeight = 19.2
	GeometryIsSmall = No
	;Shadow = SHADOW_DECAL
	;Shadow = SHADOW_VOLUME	
	;ShadowSizeX = 10;
	;ShadowSizeY = 10;
	;ShadowTexture = ShadowI;
End

;------------------------------------------------------------------------------
; aka Oathbreakers, Dead, Army of the Dead
ObjectReskin RohanOathbreaker2 RohanOathbreaker1
	; *** ART Parameters ***
	
	Draw = W3DHordeModelDraw ModuleTag_01

		DefaultModelConditionState
			Model               = RUOath3B_SKN
			Skeleton            = RUOath3_SKL
            ParticleSysBone = NONE AODTrails FollowBone:no
 		End
   
		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLA
				AnimationName       = RUOath3B_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 20
			End			
		End

		AnimationState        = DYING
			Animation           = RUNA
				AnimationName     = RUOath3B_DIEA
			End
            EnteringStateFX = FX_AODDeath
		End
		
		AnimationState        =  OATH_FULLFILLED
			Animation           = WLK
				AnimationName     = RUOath3B_WLKA
				AnimationMode     = LOOP
			End
				ParticleSysBone = NONE AODtrackingLightShafts
		End

		AnimationState        =  ATTACKING
			Animation           = ATA1
				AnimationName     = RUOath3B_ATKA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.75 1.25
			End
		End

		AnimationState        =  FIRING_A
			Animation           = ATA1
				AnimationName     = RUOath3B_ATKA
				AnimationMode     = LOOP
			End
		End

		AnimationState        = MOVING
			Animation           = RUNA
				AnimationName     = RUOath3B_RUNA
				AnimationMode     = LOOP
			End
			Flags               = RANDOMSTART
		End	
	End	
End

;------------------------------------------------------------------------------
; aka Oathbreakers, Dead, Army of the Dead
ObjectReskin RohanOathbreaker3 RohanOathbreaker1
	; *** ART Parameters ***

	Draw = W3DHordeModelDraw ModuleTag_01

		DefaultModelConditionState
			Model               = RUOath3C_SKN
			Skeleton            = RUOath3_SKL
            ParticleSysBone = NONE AODTrails FollowBone:no
 		End
   
		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLA
				AnimationName       = RUOath3C_IDLB
				AnimationMode       = ONCE
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 20
			End			
		End

		AnimationState        = DYING
			Animation           = RUNA
				AnimationName     = RUOath3C_DIEA
			End
            EnteringStateFX = FX_AODDeath
		End
		
		AnimationState        =  OATH_FULLFILLED
			Animation           = WLK
				AnimationName     = RUOath3C_WLKA
				AnimationMode     = LOOP
			End
			ParticleSysBone = NONE AODtrackingLightShafts
		End

		AnimationState        =  ATTACKING
			Animation           = ATA1
				AnimationName     = RUOath3C_ATKA
				AnimationMode     = LOOP
				AnimationSpeedFactorRange = 0.75 1.25
			End
		End

		AnimationState        =  FIRING_A
			Animation           = ATA1
				AnimationName     = RUOath3C_ATKA
				AnimationMode     = LOOP
			End
		End

		AnimationState        = MOVING
			Animation           = RUNA
				AnimationName     = RUOath3C_RUNA
				AnimationMode     = LOOP
			End
			Flags               = RANDOMSTART
		End
	End
End

;------------------------------------------------------------------------------
; Rohirrim Oathbreakers on a Horse
Object RohanOathbreakersCavalry
	; *** ART Parameters ***
	; NOTE: If you are updating any of the art parameters, you should really check
	; GondorCavalryRiderless in FactionSubObject.ini and see if it needs to be updated

	SelectPortrait         = UPOathBreakers

	Draw = W3DScriptedModelDraw ModuleTag_01 
		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD

	
		DefaultModelConditionState
			Model					= RUOthHrse_SKN
		End


		IdleAnimationState
			Animation				=	IdleA
				AnimationName		=	RURohrm_SKL.RURohrm_IDLA
				AnimationPriority	=	20
				AnimationMode		=	ONCE
				AnimationBlendTime	=	15
			End
			Animation				=	IdleB
				AnimationName		=	RURohrm_SKL.RURohrm_IDLB
				AnimationMode		=	ONCE
				AnimationBlendTime	=	15
			End
		End
		
		AnimationState				=	PASSENGER
			Animation				=	grabbed
				AnimationName		=	RURohrm_SKL.RURohrm_GBDA
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End
		
		; --- stunned anims
		AnimationState				=	FREEFALL 
			Animation				=	free fall
				AnimationName		=	RURohrm_SKL.RURohrm_FLYB
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End
		
		AnimationState				=	STUNNED_FLAILING 
			Animation				=	JustDie
				AnimationName		=	RURohrm_SKL.RURohrm_FLYC
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End

		AnimationState				=	STUNNED 
			Animation				=	Land
				AnimationName		=	RURohrm_SKL.RURohrm_LNDA
				AnimationMode		=	ONCE
			End
		End

		AnimationState				=	STUNNED_STANDING_UP
			Animation				=	StandUp
				AnimationName		=	RURohrm_SKL.RURohrm_GTPA
				AnimationMode		=	ONCE
			End
		End

		; This is the no-spawn-horse type of death
		AnimationState				=	DYING     ; DEATH_2 Normally has DEATH_2, but just as a backup don't insist
			Animation				=	JustDie
				AnimationName		=	RURohrm_SKL.RURohrm_DIEA
				AnimationMode		=	ONCE
			End
		End
		
		; When the rider is killed, we call this animation even though the unit hasn't officially died yet.
		AnimationState				=	DEATH_2
			Animation				=	JustDie
				AnimationName       =	RURohrm_SKL.RURohrm_DIEB
				AnimationMode       =	ONCE
			End
		End
		
		AnimationState = MOVING ENGAGED
			Animation = Moving_Engaged
				AnimationName = RURohrm_SKL.RURohrm_RUNC
				AnimationMode = LOOP
			End
			Flags               = RANDOMSTART
		End
		
		AnimationState				=	TURN_LEFT_HIGH_SPEED
			Animation				=	TurnLeft
				AnimationName		=	RURohrm_SKL.RURohrm_TNL1
				AnimationMode		=	LOOP
;				AnimationSpeedFactorRange= 1.8 1.8
				AnimationBlendTime	=	20
			End
		End
		
		AnimationState				=	TURN_RIGHT_HIGH_SPEED
			Animation				=	TurnLeft
				AnimationName		=	RURohrm_SKL.RURohrm_TNR1
				AnimationMode		=	LOOP
;				AnimationSpeedFactorRange= 1.8 1.8
				AnimationBlendTime	=	20
			End
		End
		
		AnimationState				= MOVING WANDER
			Animation				= WLKA
				AnimationName		= RURohrm_SKL.RURohrm_WLKA
				AnimationMode		= LOOP
			End
		End

		AnimationState				=	MOVING TURN_LEFT 
			Animation				=	TurnLeft
				AnimationName		=	RURohrm_SKL.RURohrm_TRNL
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOVING TURN_RIGHT 
			Animation				=	TurnRight
				AnimationName		=	RURohrm_SKL.RURohrm_TRNR
				AnimationMode		=	LOOP
			End
		End
	
		AnimationState				=	MOVING ACCELERATE
			Animation				=	Accelerate
				AnimationName		=	RURohrm_SKL.RURohrm_ACCL
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	MOVING DECELERATE
			Animation				=	Decelerate
				AnimationName		=	RURohrm_SKL.RURohrm_DECL
				AnimationMode		=	ONCE
			End
		End

		AnimationState				=	MOVING
			Animation				=	RunA
				AnimationName		=	RURohrm_SKL.RURohrm_RUNA
				AnimationMode		=	LOOP
			End
			Flags					=	RANDOMSTART
		End

		AnimationState				=	SELECTED
			SimilarRestart			=   Yes
			Animation				=	AtAttention
				AnimationName		=	RURohrm_SKL.RURohrm_ATNA
				AnimationMode		=	ONCE
			End
		End	
	End
	
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_IMMUNE
	

	; ***DESIGN parameters ***
	Side = Men
	EditorSorting = UNIT
	ThreatLevel = 2.0
	TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT
	CommandPoints = 0

	ArmorSet
		Conditions      = None
		Armor           = CavalryLineFormationArmor
		DamageFX        = NormalDamageFX
	End
	ArmorSet
		Conditions		= ALTERNATE_FORMATION
		Armor			= CavalryWedgeFormationArmor
		DamageFX		= NormalDamageFX
	End
	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    RohanRohirrimSpear
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
		Weapon = SECONDARY	RiderlessWeapon
		AutoChooseSources = SECONDARY FROM_SCRIPT
	End
	VisionRange = 280.0
	DisplayName = OBJECT:Oathbreaker
	CrushableLevel = 4  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	CrusherLevel = 0
	
	; *** AUDIO Parameters ***;

    #include "..\includes\StandardUnitEvaEvents.inc"

	VoiceAttack			= OathbreakerVoxSelect
;	VoiceCreated		= OathbreakerVoxSelect
;	VoiceFullyCreated	= OathbreakerVoxSelect
	VoiceMove			= OathbreakerVoxSelect
	VoicePriority		= 16
	VoiceSelect			= OathbreakerVoxSelect
	;VoiceSelect2		= RohirrimAttention

	SoundCrushing		= RohirrimCrushing ; Sound made when crushing another unit underhoof
	SoundImpact			= ImpactHorse
	SoundMoveStart		= GondorHorseMoveStart
	
	UnitSpecificSounds
		VoiceGarrison						= OathbreakerVoxSelect
		VoiceEnterUnitElvenTransportShip	= OathbreakerVoxSelect
		VoiceEnterUnitEvilMenTransportShip	= OathbreakerVoxSelect
		VoiceEnterUnitMordorMumakil			= OathbreakerVoxSelect
		VoiceEnterUnitSlaughterHouse		= OathbreakerVoxSelect
		VoiceInitiateCaptureBuilding		= OathbreakerVoxSelect
	End

	; Tie into LargeGroupAudio system
	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
		Key = Oathbreaker
	End

    ; Warn the player when the enemy gets a unit. Override the normal sighting event from StandardUnitEvaEvents.inc
    EvaEnemyObjectSightedEvent	= DiscoveredEnemyOathbreaker		;GenericEnemyUnitSighted ; Normal response to enemy units

	ClientUpdate = EvaAnnounceClientCreate ModuleTag_CreateAnnounce
		AnnouncementEventEnemy = DiscoveredEnemyOathbreaker
		AnnouncementEventAlly = None
		AnnouncementEventOwner = None
		
		OnlyIfVisible = Yes						; Don't announce if hidden in the shroud
		CountAsFirstSightedAnnoucement = Yes	; Don't re-annouce if going into shroud & back
		UseObjectsPosition = No					; Play from central Fortress, not at unit's position
		CreateFakeRadarEvent = Yes				; Allow player to jump to unit after hearing annoucement
	End

	; *** ENGINEERING Parameters ***
	RadarPriority = UNIT
	ThingClass = CAVALRY_UNIT

	KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS CAVALRY SCORE INFANTRY ARMY_OF_DEAD
	
	Body = ActiveBody ModuleTag_02
		MaxHealth         = 100                  ;BALANCE Man at Arms Health
		MaxHealthDamaged  = 5
		;RecoveryTime      = 5000
	End

	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		AILuaEventsList	=	RohirrimFunctions
		AttackPriority = AttackPriorityCavalry
	End

	LocomotorSet
		Locomotor = HorseLocomotor
		Condition = SET_NORMAL 
		Speed     = 72
	End

	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
		ShockStunnedTimeLow		= 1400
		ShockStunnedTimeHigh	= 2400
		ShockStandingTime		= 2400
	End
	
	Behavior = OathbreakersFadeAwayBehavior ModuleTag_05
		FadeOutTime   = 3500 ;  Fade time in ms - 4000 == 4 seconds.
	End

	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= OATHBREAKER_LIFETIME
		MaxLifetime		= OATHBREAKER_LIFETIME
	End	

	Behavior = AODCrushCollide ModuleTag_06
		SmallFXList = FX_AODHitSmall; FXList for small objects.
		MediumFXList = FX_AODHitMedium; FXList for medium objects.
        ;LargeFXList = FX_AODHitLarge; FXList for medium objects.
		
		; Normal damage delivered.
		Damage = 99999.0  ; normally really lethal
		DamageType = CRUSH
		DeathType = CRUSHED
		
		SpecialObject = NONE +MordorBalrog -SELECTABLE -CAVALRY -INFANTRY -HERO -MONSTER; Special objects receive and dish out special damage.
		SpecialDamage = 100.0  ; not as lethal
		SpecialDamageType = CRUSH
		SpecialDeathType = CRUSHED
		
		SelfDamage = 9999.0  ; Damaging a special object inflicts damage on self.
		SelfDamageType = FLAME
		SelfDeathType = BURNED
	End


	Behavior = SlowDeathBehavior ModuleTag_08
		DeathTypes = ALL 
		SinkDelay = 1000
		SinkRate = 1.40     ; in Dist/Sec
		DestructionDelay = 10000
		;ProbabilityModifier = 33
		DeathFlags = DEATH_2 ; Tell model which death animation to play. Sets BOTH model condition and object status bits.
		;Sound = INITIAL OathbreakerDie
	End
	
	Geometry = CYLINDER
	GeometryMajorRadius = 10.4
	GeometryMinorRadius = 10.4
	GeometryHeight = 20.0
	GeometryIsSmall = No
	;Shadow = SHADOW_DECAL
	;ShadowSizeX = 30;
	;ShadowSizeY = 21;
	;ShadowTexture = ShadowI;

End