;------------------------------------------------------------------------------
Object AngmarShadeWolf

	; *** ART Parameters ***
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = KUWerewolfPortrait
    
    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
    ButtonImage = HIWerewolf
    
	Draw = W3DScriptedModelDraw ModuleTag_BodyDraw

		OkToChangeModelColor = Yes
	
		ExtraPublicBone	= B_PASSENGER01
;		ExtraPublicBone = ZZZWHIPCOIL
;		ExtraPublicBone = SWORD

		;-------------------------
		ModelConditionState = NONE ; Not DefaultConditionState, because that keyword copies anything in here to every other state
			Model = KUWWolf_SKN
			ParticleSysBone = None SoWolf_Ambient_fog01
			ParticleSysBone = None SoWolf_Ambient_Embers01
			ParticleSysBone = "Bip L Finger2" SoWolf_Ambient_fog FollowBone:YES	;"BIP L HAND"
			ParticleSysBone = "Bip L Finger2" SoWolf_Ambient_Embers FollowBone:YES
			ParticleSysBone = "Bip R Finger2" SoWolf_Ambient_fog FollowBone:YES	;"BIP R HAND"
			ParticleSysBone = "Bip R Finger2" SoWolf_Ambient_Embers FollowBone:YES
		End

		;-----------------		
		IdleAnimationState
			StateName = State_Idle
			Animation = Breathe 
				AnimationName = KUWWolf_SKL.KUWWolf_IDLA
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 3
			End
			Animation = LookAround 
				AnimationName = KUWWolf_SKL.KUWWolf_IDLB
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 2
			End
			Animation = SnortLikeABull 
				AnimationName = KUWWolf_SKL.KUWWolf_IDLC
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 1
			End

			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "State_JustBuilt" 
					then CurDrawableSetTransitionAnimState("TRANS_JustBuilt_To_Idle") 
				end
				if Prev == "State_AboutToHitGround" 
					then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") 
				end
			EndScript
			ParticleSysBone = None SoWolf_Ambient_snowFollowBone:YES
		End 
		
		AnimationState					=	DYING DEATH_1
			Animation				=	Dying 
				AnimationName			=	KUWWolf_SKL.KUWWolf_DIEA 
				AnimationMode			=	ONCE
			End
			;ParticleSysBone = None BalrogFallDust FollowBone:No
		End

		AnimationState					=	DYING DEATH_2
			Animation				=	FadingOut 
				AnimationName			=	KUWWolf_SKL.KUWWolf_RORA 
				AnimationMode			=	ONCE
			End
		End


		
		AnimationState					=	EATING
			FrameForPristineBonePositions 		= 99
			Animation				=	DoingHorribleThingToGrabbedGuy 
				AnimationName			=	KUWWolf_SKL.KUWWolf_SPCC
				AnimationMode			=	ONCE
				AnimationBlendTime		=	0
			End

		End

;		AnimationState					=	UNPACKING PACKING_TYPE_3
;			Animation					=	GrabbingToTouching
;				AnimationName			=	KUWWolf_SKL.KUWWolf_GRBA 
;				AnimationMode			=	ONCE
;				AnimationBlendTime		=	0
;			End
;		End
;
;		AnimationState					=	PACKING PACKING_TYPE_3
;			Animation					=	GrabbingFollowThrough 
;				AnimationName			=	KUWWolf_SKL.KUWWolf_GRBC 
;				AnimationMode			=	ONCE
;				AnimationBlendTime		=	0
;			End	
;		End

		AnimationState			= JUST_BUILT
			StateName = State_JustBuilt
			Animation
				AnimationName = KUWWolf_SKL.KUWWolf_RORA
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
		End
		
	    TransitionState = TRANS_JustBuilt_To_Idle
			Animation = BeingSummoned
				AnimationName = KUWWolf_SKL.KUWWolf_RORA 
				AnimationMode = ONCE
			End
		End
		
		AnimationState = FIRING_OR_PREATTACK_B
			Animation = CrackThatWhip 
				AnimationName = KUWWolf_SKL.KUWWolf_WIPA
				AnimationMode = ONCE
			End
				;ParticleSysBone = RTHANDBONE BalrogWhip2swordEfx FollowBone:Yes
		End
			   
		AnimationState			= SPECIAL_WEAPON_ONE
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_SPCB
				AnimationMode   = ONCE
			End
		End
			   
		AnimationState			= SPECIAL_WEAPON_TWO
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_CHRA
				AnimationMode   = ONCE
			End
		End
			   
	    AnimationState			= SPECIAL_WEAPON_THREE
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_SPCA
				AnimationMode   = ONCE
			End
		End
		
		AnimationState			= TURN_RIGHT
			Animation			= TurningRight 
				AnimationName	= KUWWolf_SKL.KUWWolf_TRNR
				AnimationMode   = LOOP
				AnimationBlendTime = 50
			End
		End

		AnimationState			= TURN_LEFT
			Animation			= TurningLeft 
				AnimationName	= KUWWolf_SKL.KUWWolf_TRNL
				AnimationMode   = LOOP
				AnimationBlendTime = 50
			End
		End

		AnimationState				= MOVING
			Animation			= Running 
				AnimationName		= KUWWolf_SKL.KUWWolf_RUNA
				AnimationMode   	= LOOP
				AnimationBlendTime 	= 10
				Distance		= 112

			End
			Flags               		= RANDOMSTART
			FXEvent	= Frame:11 FireWhenSkipped Name:FX_WolfRightFootStep
			FXEvent	= Frame:27 FireWhenSkipped Name:FX_WolfLeftFootStep
			
		End
      
				
		AnimationState			= FIRING_OR_PREATTACK_A
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_ATKA
				AnimationMode	= ONCE
				UseWeaponTiming	= Yes
			End
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_ATKB
				AnimationMode	= ONCE
				UseWeaponTiming	= Yes
			End
;			Animation			
;				AnimationName	= KUWWolf_SKL.KUWWolf_SPCA
;				AnimationMode   = ONCE
;			End
			FXEvent	= Frame:20 Name: FX_SOWolfHit
		End
		
	End

	; ***DESIGN parameters ***
	DisplayName      = OBJECT:ShadeofWolf

	Side = Neutral
	EditorSorting = UNIT
	ThreatLevel = BALROG_THREAT_LEVEL
	ThingClass = CHARACTER_UNIT

	CrusherLevel   = 4  ;What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles
	CrushWeapon = BalrogCrush  
	MinCrushVelocityPercent = 40 		; Has to be moving at at least 35% of full speed.
	CrushDecelerationPercent = 10 		; Lose 20 percent of max velocity when crushing.
	
	CrushKnockback 	= 40;
	CrushZFactor 	= 1.0;

	Scale = 1.6

	TransportSlotCount = TRANSPORTSLOTCOUNT_MONSTER
	
	WeaponSet
		Conditions = None
		Weapon = PRIMARY	AngmarShadeofWolfSwipe
	End
	
	ArmorSet
		Conditions      = None
		Armor           = ShadeofWolfArmor
		DamageFX        = NormalDamageFX
	End

	VisionRange = VISION_BALROG					
	ShroudClearingRange = SHROUD_CLEAR_BALROG

	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS
	CommandSet = ShadeofWolfCommandSet
	CanPathThroughGates	= No
	IsTrainable = No
	
	DeadCollideSize = LARGE ; How big does the AOD consider this unit for damage fx & behavior.


	;------------------ AUDIO Parameters ----------------------

	VoiceAttack			= ShadeWolfAttack
	VoiceAttackCharge		= ShadeWolfAttack
	VoiceAttackMachine	= ShadeWolfAttack
	VoiceAttackStructure	= ShadeWolfAttack
	VoiceGuard			= ShadeWolfIdle
	VoiceMove			= ShadeWolfIdle
	VoiceSelect			= ShadeWolfIdle
	VoiceSelectBattle		= ShadeWolfIdle

	SoundAmbient		= ShadeWolfIdle
	SoundImpact			= ImpactHorse

    #include "..\includes\StandardUnitEvaEvents.inc"
	
    ; Warn the player when the enemy gets a unit. Override the normal sighting event from StandardUnitEvaEvents.inc
    EvaEnemyObjectSightedEvent	= DiscoveredEnemyBalrog

;	ClientUpdate = EvaAnnounceClientCreate ModuleTag_CreateAnnounce
;		AnnouncementEventEnemy = DiscoveredEnemyBalrog
;		AnnouncementEventAlly = None
;		AnnouncementEventOwner = None
;		
;		OnlyIfVisible = Yes						; Don't announce if hidden in the shroud
;		CountAsFirstSightedAnnoucement = Yes	; Don't re-annouce if going into shroud & back
;		UseObjectsPosition = No					; Play from central Fortress, not at unit's position
;		CreateFakeRadarEvent = Yes				; Allow player to jump to unit after hearing annoucement
;	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound: BalrogFootstep			Animation: KUWWolf_SKL.KUWWolf_RUNA Frames: 42 17 
		AnimationSound = Sound: BalrogFootstep			Animation: KUWWolf_SKL.KUWWolf_TRNR Frames: 21 52
		AnimationSound = Sound: BalrogFootstep			Animation: KUWWolf_SKL.KUWWolf_TRNL Frames: 21 52
 
		AnimationSound = Sound: ShadeWolfSummonPack		Animation: KUWWolf_SKL.KUWWolf_SPCB Frames: 1 
		AnimationSound = Sound: ShadeWolfLament			Animation: KUWWolf_SKL.KUWWolf_CHRA Frames: 21 

		AnimationSound = Sound: ShadeWolfSummonHowl		Animation: KUWWolf_SKL.KUWWolf_DIEA Frames: 25
		AnimationSound = Sound: ShadeWolfSummonHowl		Animation: KUWWolf_SKL.KUWWolf_RORA Frames: 21
		AnimationSound = Sound: ShadeWolfSummonHowl		Animation: KUWWolf_SKL.KUWWolf_SPCC Frames: 50

	End


  ; *** ENGINEERING Parameters ***  

	RadarPriority = UNIT
  KindOf          = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MONSTER SCORE CAN_ATTACK NO_FREEWILL_ENTER PATH_THROUGH_INFANTRY SCARY BIG_MONSTER CAN_ATTACK_WALLS SUMMONED
  ThreatBreakdown MordorBalrog_DetailedThreat
	AIKindOf = SIEGEWEAPON
  End
	
  Body            = ActiveBody ModuleTag_02
    MaxHealth         = SHADEOFWOLF_HEALTH					;BALANCE Balrog Health
  End

  Behavior = StancesBehavior ModuleTag_StancesBehavior
    StanceTemplate = FighterHorde
  End

  Behavior = AIUpdateInterface ModuleTag_03
    AutoAcquireEnemiesWhenIdle	= Yes ATTACK_BUILDINGS
    MoodAttackCheckRate			= 500
    AILuaEventsList				= BalrogFunctions
  End

  LocomotorSet
    Locomotor     = ShadeofWolfLocomotor
    Condition     = SET_NORMAL
    Speed         = 144
  End

	Behavior = PhysicsBehavior ModuleTag_04
	    GravityMult = 1.0
	End
  
  
  	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL +FADED ;-FADED
		DestructionDelay = 6000
		FadeDelay			= 4200
		FadeTime			= 3000		
		FX = INITIAL FX_SoWolfUnsummonInitial
        	FX = FINAL FX_SoWolfUnsummonFinal
        	DeathFlags = DEATH_1
	End
  
  	Behavior = SlowDeathBehavior ModuleTag_FadeDeath
		DeathTypes = NONE +FADED
		DestructionDelay = 3850
		FadeDelay			= 1000
		FadeTime			= 2666
        	FX = INITIAL FX_SoWolfUnsummon
        	DeathFlags = DEATH_2
	End
  
  
;--------------------------------SPECIAL ABILITIES--------------------------------------------------  
	;;;; DARK LORD'S LAMENT SPECIAL ABILITY ;;;;;;;;--------------------------------------------------------------------

	Behavior = SpecialPowerModule ModuleTag_LamentStarter       
		SpecialPowerTemplate      = SpecialAbilityDarkLordsLament
		UpdateModuleStartsAttack  = Yes
		StartsPaused		  = No
		InitiateSound		= BalrogRoar
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LamentWeaponFireUpdate   
		SpecialPowerTemplate    = SpecialAbilityDarkLordsLament
		SpecialWeapon			= AngmarDarkLordsLamentWeapon
		WhichSpecialWeapon		= 2			; Corresponds to SPECIAL_WEAPON_THREE
		StartAbilityRange		= 10.0
		
		SkipContinue			= Yes
		UnpackTime			= 1000		; Trigger on frame 60 (of 100)
		PackTime			= 2000		; Remaining 40 frames (of 100)
		MustFinishAbility		= Yes
	End

	;------------------- Call The PAck ------------------
  
	
	Behavior = SpecialPowerModule ModuleTag_CallPackStarter                      
		SpecialPowerTemplate		= SpecialAbilityCallPack
		TriggerFX 			= FX_SoWolf_SummonPack
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= No
		InitiateSound			= WargHowlAbility
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate   
		SpecialPowerTemplate    = SpecialAbilityCallPack

		UnpackTime              = 500
		PackTime                = 1000

		StartAbilityRange 	= 100.0
		
		SpecialWeapon 		= ShadeCallthePack
		WhichSpecialWeapon 	= 1
	End
	
	
	;//----------------------Man Eater-----------------------------------------------	


	Behavior = SpecialPowerModule ModuleTag_SpecialPowerModuleGrabStarter
		SpecialPowerTemplate		= SpecialAbilityAngmarShadeEatMeGrab
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= No
		InitiateSound			= BalrogChuckle
	End
	
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WeaponFireSpecialAbilityUpdateGrab
		SpecialPowerTemplate		= SpecialAbilityAngmarShadeEatMeGrab
		SkipContinue			= Yes
		UnpackTime			= 533						; Frame 28/99
;		PackTime			= 2367						; Remaining 71/99 frames
		
		StartAbilityRange		= 12.0
		
		SpecialWeapon			= AngmarShadeChompWeapon
		ChainedButton			= Command_SpecialAbilityShadeChompFlingPassenger
		CustomAnimAndDuration		= AnimState:EATING AnimTime:3333
		MustFinishAbility		= Yes

		TriggerAttributeModifier	= SharkuManEater
		AttributeModifierDuration	= 20000
		TriggerSound				= SharkuManEaterEatingMS
		BusyForDuration				= 5000
	End

	Behavior = PlayerHealSpecialPower ModuleTag_SpecialPowerModuleFlingPassengerStarter
		SpecialPowerTemplate		= SpecialAbilityAngmarShadeEatMeDrop
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= No
		HealAmount			= 1.0
		HealAsPercent			= Yes
		HealAffects			= HERO
		HealRadius			= 0.0
		HealFX				= FX_SpellHealUnitHealBuff
	End

	Behavior = FlingPassengerSpecialAbilityUpdate ModuleTag_FlingPassengerSpecialAbilityUpdate
		SpecialPowerTemplate			= SpecialAbilityAngmarShadeEatMeDrop
		UnpackTime				= 1250
		FlingPassengerVelocity			= X:0 Y:0 Z:0
		FlingPassengerLandingWarhead		= AngmarShadeChompWarhead    ;kills victim when released
		MustFinishAbility		= Yes
	End		
	
	Behavior = TransportContain ModuleTag_09
		ObjectStatusOfContained = UNSELECTABLE
		PassengerFilter			= ANY +INFANTRY
;		ManualPickUpFilter		= NONE +INFANTRY ; we do not want the user to be able to manually pick up an orc with a troll.
		Slots					= 1
		ShowPips				= No
		AllowEnemiesInside		= Yes
		AllowNeutralInside		= Yes
		AllowAlliesInside		= No
		;DamagePercentToUnits	= 500%
		DestroyRidersWhoAreNotFreeToExit = Yes
		ForceOrientationContainer = No
		PassengerBonePrefix = PassengerBone:B_PASSENGER01		KindOf:INFANTRY
;		EjectPassengersOnDeath = Yes
	End


	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate ManEaterAI
		CommandButtonName = Command_SpecialAbilityShadeChomp
		SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
	End

	Behavior = AISpecialPowerUpdate CallThePackAI
		CommandButtonName = Command_SpecialAbilityCallPack
		SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
	End

	Behavior = AISpecialPowerUpdate LamentAI
		CommandButtonName = Command_SpecialAbilityDarkLordsLament
		SpecialPowerRange = 100
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_DEBUFF
	End



	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= BALROG_LIFETIME
		MaxLifetime		= BALROG_LIFETIME
		DeathType		= FADED
	End
	
	Behavior = CreateObjectDie ModuleTag_CrushUnitsOnDeath
		CreationList = OCL_BalrogDie
 	End

	Geometry			= CYLINDER
	GeometryMajorRadius = 18.0
	GeometryHeight		= 90.0
  	GeometryOffset		= X:-20 Y:0 Z:0
	GeometryIsSmall		= No
	
	Shadow				= SHADOW_VOLUME ;SHADOW_DECAL	; SHADOW_VOLUME has trouble with his wings.  Possibly because of the transparent bits
	ShadowSizeX			= 100
	ShadowSizeY			= 100
	ShadowTexture		= ShadowI
End

;------------------------------------------------------------------------------
Object ShadeCallthePack

 	Draw = W3DScriptedModelDraw ModuleTag_01
    	DefaultModelConditionState
	      	Model = None
    	End
  	End
	EditorSorting   = SYSTEM
	KindOf = NO_COLLIDE IMMOBILE UNATTACKABLE INERT 
	ForceLuaRegistration = Yes ; I have no AI, but I want to send a fear message so please register me.

	; *** ENGINEERING Parameters ***
	Body = ImmortalBody ModuleTag_02
		MaxHealth = 1    
		InitialHealth = 1
	End

	Behavior = DeletionUpdate ModuleTag_03 ; Not LifetimeUpdate, since I can't die.  This will DestroyObject me. 
		MinLifetime = 10000   
		MaxLifetime = 10000   
	End
	
	Behavior = FloodUpdate ModuleTag_PackCentral
		AngleOfFlow = 0	; In degrees, with 0 as screen right
		DirectionIsRelative = Yes ; If it is relative, it adds the facing of the flood object.
		
		FloodMember
			MemberTemplateName = PackWolf
			ControlPointOffsetOne =		X:-100 Y:10 Z:0	; Offset from center point of flood.
			ControlPointOffsetTwo =		X:-50 Y:35 Z:0
			ControlPointOffsetThree =	X:20 Y:50 Z:0
			ControlPointOffsetFour =	X:100 Y:50 Z:0
			MemberSpeed = 16
		End

		FloodMember
			MemberTemplateName = PackWolf
			ControlPointOffsetOne =		X:-100 Y:5 Z:0	; Offset from center point of flood.
			ControlPointOffsetTwo =		X:-50 Y:17.5 Z:0
			ControlPointOffsetThree =	X:20 Y:25 Z:0
			ControlPointOffsetFour =	X:100 Y:25 Z:0
			MemberSpeed = 21
		End

		FloodMember
			MemberTemplateName = PackWolf
			ControlPointOffsetOne =		X:-100 Y:0 Z:0	; Offset from center point of flood.
			ControlPointOffsetTwo =		X:-50 Y:0 Z:0
			ControlPointOffsetThree =	X:20 Y:0 Z:0
			ControlPointOffsetFour =	X:100 Y:0 Z:0
			MemberSpeed = 25
		End

		FloodMember
			MemberTemplateName = PackWolf
			ControlPointOffsetOne =		X:-100 Y:-5 Z:0	; Offset from center point of flood.
			ControlPointOffsetTwo =		X:-50 Y:-17 Z:0
			ControlPointOffsetThree =	X:20 Y:-25 Z:0
			ControlPointOffsetFour =	X:100 Y:-25 Z:0
			MemberSpeed = 21
		End
		
		FloodMember
			MemberTemplateName = PackWolf
			ControlPointOffsetOne =		X:-100 Y:-10 Z:0	; Offset from center point of flood.
			ControlPointOffsetTwo =		X:-50 Y:-35 Z:0
			ControlPointOffsetThree =	X:20 Y:-50 Z:0
			ControlPointOffsetFour =	X:100 Y:-50 Z:0
			MemberSpeed = 16
		End
		
	End
	
	Geometry            = BOX
	GeometryMajorRadius = 10.0
	GeometryMinorRadius = 1.0
	GeometryHeight      = 3.0
	GeometryIsSmall     = No
	Shadow              = NONE
End

